import type { NextPage } from 'next'
import Head from 'next/head'
import { Layout } from '../components/main/layout'
import { Stepwize } from '../components/stepwize/stepwize'
import { Testimonial, Testimony } from '../components/testimonial'
import { SectionContainer } from '../components/sectionContainer'
import styles from '../styles/Home.module.css'
import { LayoutPage } from '../types'
import { Teaser } from '../components/elements/teaser'
import { groq } from 'next-sanity'
import { getClient } from '../lib/sanity.server'
import Link from 'next/link'
import { SalesPitch } from '../components/elements/salespitch'
import { SalesPitchPoint } from '../components/elements/salespitchitem'

const Home: LayoutPage<{ data: any }> = ({ data }) => {
  return (
    <>
      <Head>
        <title>Konduit.</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <div className={styles.hero}>
        <div className={styles.header}>
          <h1>{data.frontpage[0].main_heading}</h1>
        </div>
        <div className={styles.action}>
          <Link href={data.frontpage[0].sub_heading_link_target} passHref>{data.frontpage[0].sub_heading}</Link>
        </div>
      </div>

      <SectionContainer heading=''>
        <SalesPitch points={data.frontpage[0].salespitch.map((pitch: SalesPitchPoint, i: number) => ({
          number: i+1,
          heading: pitch.heading,
          paragraph: pitch.paragraph
        }))}></SalesPitch>
      </SectionContainer>
      
      <SectionContainer heading=''>
        <div className={styles.teasers}>
          {data.frontpage[0].teasers.map(
            ({ _key, title, paragraph, link, imageurl }: Teaser & { _key: string }) =>
            <Teaser 
              key={_key}
              title={title}
              paragraph={paragraph}
              link={link}
              imageurl={imageurl}></Teaser>)
          }
        </div>
      </SectionContainer>
      <SectionContainer heading="Slik fungerer det">
        <Stepwize />
      </SectionContainer>
      <SectionContainer heading="Hva folk sier om oss">
        {data.frontpage[0].testimonials.map(
          ({ _key, quote, quotee, quoteeBackground, imageurl }: Testimony & { _key: string }) =>
            <Testimonial
              key={_key}
              quote={quote}
              quotee={quotee}
              quoteeBackground={quoteeBackground}
              imageurl={imageurl}
            />)
        }
      </SectionContainer>
    </>
  )
}


export async function getStaticProps({ preview = false }) {
  const data = await getClient(preview).fetch(fetchFrontpage)

  return {
    props: {
      preview,
      data,
    },
  }
}

const fetchFrontpage = groq`
{
  "frontpage": *[_type == "frontpage"] {
    main_heading,
    sub_heading,
    sub_heading_link_target,
    salespitch,
    key_points,
    testimonials[] {
      ...,
      "imageurl": image.asset->url
    },
    teasers[] {
      ...,
      "imageurl": image.asset->url
    },
  },
}
`

Home.layout = Layout
export default Home
