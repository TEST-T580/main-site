import type { NextPage } from 'next'
import Head from 'next/head'
import { Layout } from '../components/main/layout'
import { Stepwize } from '../components/stepwize/stepwize'
import { Testimonial, Testimony } from '../components/testimonial'
import { SectionContainer } from '../components/sectionContainer'
import styles from '../styles/Home.module.css'
import { LayoutPage } from '../types'
import { groq } from 'next-sanity'
import { getClient } from '../lib/sanity.server'
import Link from 'next/link'

const Home: LayoutPage<{ data: any }> = ({ data }) => {
  return (
    <>
      <Head>
        <title>Konduit.</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <div className={styles.hero}>
        <div className={styles.header}>
          <h1>{data.frontpage[0].main_heading}</h1>
        </div>
        <div className={styles.action}>
          <Link href={data.frontpage[0].sub_heading_link_target} passHref>{data.frontpage[0].sub_heading}</Link>
        </div>
      </div>

      <pre>{data.frontpage[0].key_points[0].body}</pre>
      <SectionContainer heading="Slik fungerer det">
        <Stepwize />
      </SectionContainer>
      <SectionContainer heading="Hva folk sier om oss">
        {data.frontpage[0].testimonials.map(
          ({ quote, quotee, quoteeBackground }: Testimony) =>
            <Testimonial
              quote={quote}
              quotee={quotee}
              quoteeBackground={quoteeBackground}
            />)
        }
      </SectionContainer>
    </>
  )
}


export async function getStaticProps({ preview = false }) {
  const data = await getClient(preview).fetch(fetchFrontpage)

  return {
    props: {
      preview,
      data,
    },
  }
}

const fetchFrontpage = groq`
{
  "frontpage": *[_type == "frontpage"] {
    main_heading,
    sub_heading,
    sub_heading_link_target,
    key_points,
    testimonials,
  },
}
`

Home.layout = Layout
export default Home
